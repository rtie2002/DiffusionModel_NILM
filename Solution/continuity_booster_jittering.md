# æŠ€æœ¯è¯¦è§£ï¼šContinuity Booster ä¸ Jittering æœºåˆ¶

åœ¨ NILM (éä¾µå…¥å¼è´Ÿè·ç›‘æµ‹) ä»»åŠ¡ä¸­ï¼Œç”µå™¨å¤§éƒ¨åˆ†æ—¶é—´å¤„äºå…³é—­çŠ¶æ€ï¼ˆSparsityï¼‰ï¼Œå¯¼è‡´è®­ç»ƒæ•°æ®ä¸­â€œ0 ç“¦ç‰¹â€çš„æ¯”ä¾‹è¿œé«˜å‡ºæœ‰æ•ˆå·¥ä½œæ³¢å½¢ï¼ˆClass Imbalanceï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæœ¬é¡¹ç›®åœ¨ `real_datasets.py` ä¸­å®ç°äº† **Continuity Booster** å’Œ **Jittering**ã€‚

---

## 1. Continuity Booster (è¿ç»­æ€§å¢å¼ºå™¨)

### ğŸ“Š æ ¸å¿ƒå‚æ•°
*   **æ¿€æ´»é˜ˆå€¼ ($T$):** `0.05` (å½’ä¸€åŒ–åçš„åŠŸç‡å€¼)
*   **å¢å¼ºå› å­ ($F$):** `4` (æ€»é‡‡æ ·å€æ•°)

### ğŸ§  æ•°å­¦é€»è¾‘ä¸å…¬å¼
Booster é¦–å…ˆè¯†åˆ«æ•°æ®é›†ä¸­çš„â€œæ´»è·ƒçª—å£â€ï¼ˆActive Windowsï¼‰ã€‚å¯¹äºæ¯ä¸€ä¸ªçª—å£åºå· $i$ï¼Œå…¶æœ€å¤§åŠŸç‡å®šä¹‰ä¸ºï¼š
$$P_{max}(i) = \max_{t \in [0, L]} (x_{i, t}^{(0)})$$
å…¶ä¸­ $L$ æ˜¯çª—å£é•¿åº¦ (512)ï¼Œ$x^{(0)}$ æ˜¯å½’ä¸€åŒ–åçš„åŠŸç‡åˆ—ã€‚

**æ´»è·ƒåˆ¤å®šå‡†åˆ™ï¼š**
$$i \in \text{ActiveSet} \iff P_{max}(i) > T$$

**æ•°æ®æ‰©å……é€»è¾‘ï¼š**
æ¨¡å‹ä¼šå°† $\text{ActiveSet}$ ä¸­çš„æ ·æœ¬è¿›è¡Œ $F$ å€å¤åˆ¶ï¼Œä½¿å¾—åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹çœ‹åˆ°â€œç”µå™¨å¼€å¯â€çŠ¶æ€çš„æ¦‚ç‡ $P(\text{ON})$ æå‡äº† 4 å€ã€‚

---

## 2. Jittering (æ—¶é—´è½´æŠ–åŠ¨)

Jittering æ˜¯ä¸€ç§éšæœºå¢å¼ºæŠ€æœ¯ï¼Œæ—¨åœ¨é˜²æ­¢æ¨¡å‹æ­»è®°ç¡¬èƒŒ (Overfitting) ç‰¹å®šçš„æ³¢å½¢èµ·å§‹ç‚¹ã€‚

### ğŸ“Š æ ¸å¿ƒå‚æ•°
*   **æŠ–åŠ¨èŒƒå›´ ($\delta$):** $[-2, 2]$ ä¹‹é—´çš„éšæœºæ•´æ•°

### ğŸ§  æ•°å­¦é€»è¾‘ä¸å…¬å¼
å¯¹äº Booster å¤åˆ¶å‡ºæ¥çš„æ¯ä¸€ä¸ªæ´»è·ƒçª—å£ç´¢å¼• $i_{active}$ï¼Œæˆ‘ä»¬ä¸ºå…¶æ·»åŠ ä¸€ä¸ªå¹³ç§»é‡ $\delta$ï¼š
$$\delta \sim \text{Uniform}(\{-2, -1, 0, 1, 2\})$$

**æœ€ç»ˆè®­ç»ƒç´¢å¼•è®¡ç®—ï¼š**
$$i_{train} = \text{clamp}(i_{active} + \delta, 0, N-1)$$
å…¶ä¸­ $N$ æ˜¯æ•°æ®é›†çš„æ€»é•¿åº¦ã€‚

---

## ğŸ› ï¸ ä»£ç å®ç° (Code Snippet)

ä»¥ä¸‹æ˜¯ `Utils/Data_utils/real_datasets.py` ä¸­çš„å…·ä½“å®ç°é€»è¾‘ï¼š

```python
# 1. è¯†åˆ«æ´»è·ƒçª—å£ (Detection)
active_ids = []
for idx in train_indices:
    if np.max(data[idx : idx + self.window, 0]) > 0.05: # T = 0.05
        active_ids.append(idx)

# 2. æ‰§è¡Œå¢å¼ºä¸æŠ–åŠ¨ (Boost & Jitter)
if len(active_ids) > 0:
    boost_factor = 4 # F = 4
    boosted_versions = [train_indices] # ä¿ç•™ä¸€ä»½åŸå§‹è®­ç»ƒé›†
    
    for _ in range(boost_factor - 1):
        # ç”ŸæˆèŒƒå›´åœ¨ [-2, 2] çš„éšæœºæŠ–åŠ¨
        jitter = np.random.randint(-2, 3, size=len(active_ids)) 
        
        # åº”ç”¨å¹³ç§»å¹¶é˜²æ­¢å‡ºç•Œ
        jittered_active = np.clip(active_ids + jitter, 0, self.sample_num_total - 1)
        boosted_versions.append(jittered_active)
    
    # æ‹¼æ¥åŸæœ¬çš„è®­ç»ƒé›†ä¸å¢å¼ºåçš„æ´»è·ƒæ ·æœ¬
    train_indices = np.concatenate(boosted_versions)
```

---

## ğŸ“ˆ æ•°å­¦å½±å“æ€»ç»“

| ç»´åº¦ | å½±å“æ–¹å¼ | æœ€ç»ˆæ•ˆæœ |
| :--- | :--- | :--- |
| **æ¢¯åº¦åˆ†å¸ƒ (Gradients)** | å¢åŠ äº†éé›¶åŠŸç‡æ ·æœ¬åœ¨ Loss è®¡ç®—ä¸­çš„æƒé‡ | æ¨¡å‹ä¸å†ä¸ºäº†é™ä½ Loss è€Œé€‰æ‹©ä¸€ç›´é¢„æµ‹ 0 |
| **å¹³ç§»ä¸å˜æ€§ (Invariance)** | é€šè¿‡ $\pm 2$ çš„æŠ–åŠ¨å¢åŠ æ•°æ®å¤šæ ·æ€§ | æ¨¡å‹å­¦åˆ°æ³¢å½¢çš„ç‰©ç†ç‰¹å¾ï¼Œè€Œéå›ºå®šçš„æ—¶åˆ» |
| **æ¦‚ç‡å¯†åº¦ (PDF)** | å°† $P(x=0)$ çš„æç«¯å°–å³°ç¨å¾®å¹³æ•´åŒ– | ç”Ÿæˆå‡ºçš„åŠŸç‡åˆ†å¸ƒä¸çœŸå®åˆ†å¸ƒæ›´åŠ å»åˆ |

**ç»“è®ºï¼š**
é€šè¿‡è¿™ä¸¤é¡¹æŠ€æœ¯çš„ç»“åˆï¼Œæ‰©æ•£æ¨¡å‹åœ¨é‡‡æ ·æ—¶èƒ½æ›´å‹‡æ•¢ã€æ›´å‡†ç¡®åœ°ç”Ÿæˆå‡ºç¬¦åˆçœŸå®ç‰©ç†è§„å¾‹çš„ç”µå™¨æ³¢å½¢ï¼ˆActive Cyclesï¼‰ï¼Œè€Œä¸æ˜¯ç”Ÿæˆä¸€ç‰‡å¹³å¦çš„èƒŒæ™¯å™ªå£°ã€‚
